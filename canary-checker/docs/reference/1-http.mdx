---
title: HTTP
sidebar_position: 0
sidebar_custom_props:
  icon: http
---

# <Icon name="http"/> HTTP

<!-- Source: modules/canary-checker/api/v1/checks.go#HTTPCheck -->

This check performs queries on HTTP to monitor their activity.

```yaml title=http-check.yaml file=<rootDir>/modules/canary-checker/fixtures/minimal/http_single_pass.yaml
```

<HealthCheck name="http" connection="url"  rows={[
  {field: "url", description: "HTTP URL", scheme: "string", required: true},
  {field: "method", description: "HTTP Request method", default: "GET", scheme: "string"},
  {field: "headers", description: "Header fields", scheme: "[]EnvVar"},
  {field: "body", description: "Request Body Contents", scheme: "string"},
  {field: "connection", description: "Connection name e.g. connection://http/google", scheme: "string"},
  {field: "username", description: "Username for authentication", scheme: "EnvVar"},
  {field: "password", description: "Password for authentication", scheme: "EnvVar"},
  {field: "oauth2", description: "OAuth2 configuration", scheme: "[OAuth2Config](#oauth)"},
  {field: "tlsConfig", description: "TLS config", scheme: "[TLSConfig](#tls-config)"},
  {field: "templateBody", description: "If true body is templated", default: false, scheme: "bool"},
  {field: "responseCodes", description: <>Expected HTTP response codes<br/>Equivalent to <code>test.expr: code in [200, 201]</code></>, scheme: "[]int"},
  {field: "responseContent", description: <>Expected response body content<br/>Equivalent to <code>test.expr: content.contains("value")</code></>, scheme: "string"},
  {field: "responseJSONContent", description: "Deprecated: Use expr and jsonpath function", scheme: "JSONCheck", deprecated: true},
  {field: "thresholdMillis", description: "Maximum duration in milliseconds for the HTTP request. It will fail the check if it takes longer", default: 5000, scheme: "int"},
  {field: "maxSSLExpiry", description: <>Maximum number of days until the SSL Certificate expires<br/>Equivalent to <code>test.expr: sslAge &lt; Age("7d")</code></>, scheme: "int"},
  {field: "env", description: "Environment variables that are accessible while templating", scheme: "[]EnvVar"},
  {field: "ntlm", description: "When set to true will authenticate using NTLM v1 protocol", scheme: "bool"},
  {field: "ntlmv2", description: "When set to true will authenticate using NTLM v2 protocol", scheme: "bool"},
  {field: "crawl", description: "Crawl configuration for following links", scheme: "[Crawl](#crawl-configuration)"},
  {field: "endpoint", description: "Deprecated: Use url instead", scheme: "string", deprecated: true},
]}/>

### TLS Config

<Fields rows={[
  {field: "ca", description: "PEM encoded certificate of the CA to verify the server certificate", scheme: "EnvVar"},
  {field: "cert", description: "PEM encoded client certificate", scheme: "EnvVar"},
  {field: "key", description: "PEM encoded client private key", scheme: "EnvVar"},
  {field: "handshakeTimeout", description: "Timeout for SSL handshake (defaults to 10 seconds)", scheme: "Duration"},
  {field: "insecureSkipVerify", description: "Controls whether a client verifies the server's certificate chain and host name", scheme: "bool"}
]}/>

<details summary="Verifying against an external CA">

```yaml title=http-check.yaml   file=<rootDir>/modules/canary-checker/fixtures/minimal/http_tls_config.yaml
```

</details>

### OAuth

<Fields rows={[
  {field: "tokenURL", description: "URL for OAuth Token", scheme: "string"},
  {field: "scope", description: "Scope for OAuth token request", scheme: "[]string"},
  {field: "params", description: "Parameters for OAuth", scheme: "map[string]string"},
]}/>

### Crawl Configuration

<Fields rows={[
  {field: "filters", description: "List of regex filters to apply to the crawled links", scheme: "[]string"},
  {field: "depth", description: "Maximum number of links to follow", scheme: "int"},
  {field: "allowedDomains", description: "List of domains to crawl", scheme: "[]string"},
  {field: "disallowedDomains", description: "List of domains to exclude from crawling", scheme: "[]string"},
  {field: "allowedURLFilters", description: "List of URL regex patterns to include", scheme: "[]string"},
  {field: "disallowedURLFilters", description: "List of URL regex patterns to exclude", scheme: "[]string"},
  {field: "delay", description: "Duration to wait before creating a new request to the matching domains", default: "500ms", scheme: "Duration"},
  {field: "randomDelay", description: "Extra randomized duration to wait added to Delay before creating a new request", default: "100ms", scheme: "Duration"},
  {field: "parallelism", description: "Number of the maximum allowed concurrent requests", default: 2, scheme: "int"},
]}/>

### Result Variables

Result variables can be used in `test`, `display` and `transform` [expressions](../concepts/expressions)

| Name      | Description                                                                 | Scheme              |
| --------- | --------------------------------------------------------------------------- | ------------------- |
| `code`    | HTTP response code                                                          | `int`               |
| `headers` | HTTP response headers                                                       | `map[string]string` |
| `elapsed` | HTTP Request duration                                                       | `time.Duration`     |
| `sslAge`  | Time until SSL certificate expires                                          | `time.Duration`     |
| `content` | HTTP Response body                                                          | string              |
| `json`    | If `Content-Type=application/json` response body converted into JSON object | `JSON`              |

The above canary (`http-check.yaml`) is functionally equivalent to `http-check-expr.yaml` below

```yaml title=http-check-expr.yaml file=<rootDir>/modules/canary-checker/fixtures/minimal/http_tls_check_pass.yaml
```

## Authentication

<details summary="Basic Authentication">

<div>
```yaml title="http_auth.yaml"   file=<rootDir>/modules/canary-checker/fixtures/minimal/http_auth_from_secret.yaml
```
</div>
</details>

## Template Body Variables

| Name                  | Description                    | Scheme              |
| --------------------- | ------------------------------ | ------------------- |
| `canary.name`         | Canary name                    | `string`            |
| `canary.namespace`    | Canary namespace               | `string`            |
| `canary.labels`       | Canary labels                  | `map[string]string` |
| `canary.id`           | Persisted Canary ID            | `string`            |
| `check.name`          | Check name                     | `string`            |
| `check.id`            | Check ID                       | `string`            |
| `check.description`   | Check description              | `string`            |
| `check.labels`        | Check labels                   | `map[string]string` |
| `check.endpoint`      | Check endpoint/URL             | `string`            |
| `{envVar.name}`       | Environment variables defined in `env` | `any`        |

Variables defined in `env` are available to template with the name that's configured on the spec.
Eg: In the following spec, the var `db`, defined in `env`, is available as `{{.db}}` during templating.

<details summary="Templating request body from env variables">

<div>
```yaml title="http_template.yaml"   file=<rootDir>/modules/canary-checker/fixtures/minimal/http_template.yaml
```
</div>
</details>

<details summary="Templating URL from env variables">

<div>
```yaml title="http_user_pass_template.yaml" file=<rootDir>/modules/canary-checker/fixtures/minimal/http_auth_url_pass.yaml
```
</div>
</details>

See <CommonLink to="gotemplate" anchor="escaping">Escaping variables</CommonLink>

## Metrics

| **HTTP Check Metrics**                                        |         |                                         |
| ------------------------------------------------------------- | ------- | --------------------------------------- |
| `canary_check_http_response_status{status, statusClass, url}` | Counter | Response code counter for each endpoint |
| `canary_check_http_ssl_expiry{url}`                           | Gauge   |                                         |

Status class is one of `1xx`, `2xx`, `3xx`, `4xx`, `5xx`

<details summary="Adding custom metrics">

<div>
```yaml title="metrics.yaml"   file=<rootDir>/modules/canary-checker/fixtures/minimal/metrics.yaml
```
</div>
</details>

<details summary="Transforming metrics into individual checks">

<div>
```yaml title="metrics.yaml"   file=<rootDir>/modules/canary-checker/fixtures/minimal/metrics-transformed.yaml
```
</div>
</details>
