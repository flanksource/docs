---
title: Folder
---

# <Icon name="smb" /> Folder

Checks the contents of a folder for size, age and count. Folder based checks are useful in a number of scenarios:

* Verifying that backups have been uploaded and are the appropriate size
* Checking that logs or other temporary files are being cleaned up
* For batch processes:
  * Checking if files are being processed (and/or produced)
  * Checking the size of queue processing backlog
  * Checking if any error (`.err` or `.log`) files have been produced.

```yaml title="folder-check.yaml"
apiVersion: canaries.flanksource.com/v1
kind: Canary
metadata:
  name: folder-check
spec:
  interval: 30
  folder:
    - path: /etc/
      name: folder-check-min
      description: Checks if there are at least 10 files in the folder
      minCount: 10
```

| Field      | Description                                                  | Scheme                          | Required |
| ---------- | ------------------------------------------------------------ | ------------------------------- | -------- |
| **`path`** | A local folder path or a remote folder `smb://`, `sftp://`, `s3://` or `gcs://`  | string                          | Yes      |
| `sftpConnection` | Connection details                                   | [SFTPConnection](./connections.mdx#sftp) | Yes |
| `gcpConnection` | Connection details for GCP                                                                                                        | [GCPConnection](./connections.mdx#gcp)      |          |
| `awsConnection` | AWS Access credentials                                     | [AWSConnection](./connections.mdx#aws) |          |
| `smbConnection` | SMB connection details                                     | [SMBConnection](./connections.mdx#smb) |          |
| `filter`   | Filter objects out before checking if they are valid         | [*FolderFilter*](#folderfilter) |          |
| `minCount` | The minimum number of files inside the `path`                | int                             |          |
| `maxCount` | The maximum number of files inside the `path`, can be used in conjunction with `filter.regex` to detect error files | *int*                           |          |
| `minAge`   | The youngest age a file can be                               | [*Duration*](#duration)         |          |
| `maxAge`   | The oldest age a file can be, often used to check for unprocessed files or files that have not been cleaned up | [*Duration*](#duration)         |          |
| `minSize`  | The minimum file size, can be used to detect backups that did not upload successfully | [Size](#size)                   |          |
| `maxSize`  | The maximim file size                                        | [Size](#size)                   |          |
| **`name`**    | Name of the check, must be unique within the canary         | `string`                                     | Yes      |
| `description` | Description for the check                                   | `string`                                     |          |
| `icon`        | Icon for overwriting default icon on the dashboard          | `string`                                     |          |
| `labels`      | Labels for check                                            | `map[string]string`                          |          |
| `test`        | Evaluate whether a check is healthy                         | [`Expression`](../concepts/health-evaluation)  |          |
| `display`     | Expression to change the formatting of the display          | [`Expression`](../concepts/display-formatting) |          |
| `transform`   | Transform data from a check into multiple individual checks | [`Expression`](../concepts/transforms)          |          |
| `metrics`     | Metrics to export from                                      | [`[]Metrics`](../concepts/metrics-exporter)    |          |

## Duration

Durations are strings with an optional fraction and unit e.g.  `300ms`, `1.5h` or `2h45m`. Valid time units are `ms`, `s`, `m`, `h`.

## Size

Sizes are string with a unit suffix e.g. `100` / `100b`, `10mb`, Valid size units are `kb`, `mb`, `gb`, `tb`

## FolderFilter

| Field     | Description                                                 | Scheme                                               | Required |
| --------- | ----------------------------------------------------------- | ---------------------------------------------------- | -------- |
| `maxAge`  | MaxAge the latest object should be younger than defined age | [*Duration*](#duration)                              |          |
| `maxSize` | MaxSize of the files inside the searchPath                  | [Size](#size)                                        |          |
| `minAge`  | MinAge the latest object should be older than defined age   | [*Duration*](#duration)                              |          |
| `minSize` | MinSize of the files inside the searchPath                  | [Size](#size)                                        |          |
| `regex`   | Filter files based on regular expression                    | *[regex](https://github.com/google/re2/wiki/Syntax)* |          |

e.g. to verify that database backups are being performed

```yaml title="postgres-backup-check.yaml"
apiVersion: canaries.flanksource.com/v1
kind: Canary
metadata:
  name: folder-check
spec:
  interval: 30
  folder:
    - path: /data/backups
      filter:
        regex: "pg-backups-.*.zip"
      maxAge: 1d # require a daily backup
      minSize: 10mb # the backup should be at least 10mb
```

## Result Variables

The following fields are available in `test`, `display` and `transform` [expressions](../concepts/expressions)

| Field                 | Scheme                                             |
| --------------------- | -------------------------------------------------- |
| `Oldest`                | [os.FileInfo](https://pkg.go.dev/io/fs#FileInfo)   |
| `Newest`                | [os.FileInfo](https://pkg.go.dev/io/fs#FileInfo)   |
| `MinSize`               | [os.FileInfo](https://pkg.go.dev/io/fs#FileInfo)   |
| `MaxSize`               | [os.FileInfo](https://pkg.go.dev/io/fs#FileInfo)   |
| `SupportsTotalSize` (Only true for SMB folders) | bool                                               |
| `SupportsAvailableSize` (Only true for SMB folders) | bool                                               |
| `TotalSize`             | int64                                              |
| `AvailableSize`         | int64                                              |
| `Files`                 | [[]os.FileInfo](https://pkg.go.dev/io/fs#FileInfo) |

### FolderFilter

| Field     | Description | Scheme                  | Required |
| --------- | ----------- | ----------------------- | -------- |
| `minAge`  |             | [`Duration`](#duration) |          |
| `maxAge`  |             | [`Duration`](#duration) |          |
| `minSize` |             | [`Size`](#size)         |          |
| `maxSize` |             | [`Size`](#size)         |          |
| `regex`   |             | `string`                |          |


## Connection Types

### SFTP

```yaml title="sftp-check.yaml"
# ...
kind: Canary
spec:
  folder:
  //highlight-next-line
  - path: folder
    sftpConnection:
      host: 192.168.1.9
      # ...
```

| Field        | Description                                                  | Scheme                                            |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------- |
| `connection` | Path of existing connection e.g. `connection://sftp/instance`<br /> Mutually exclusive with `username` <br /><Commercial /> | <CommonLink to="connection" >*Connection*</CommonLink>          |
| `username`   | utually exclusive with `connection`                          | <CommonLink to="authentication">*EnvVar*</CommonLink> |
| `password`   | <SkipOSS>Mutually exclusive with `connection`</SkipOSS>                           | <CommonLink to="authentication">*EnvVar*</CommonLink> |
| `host`       | Custom AWS Cloudwatch endpoint                               | *string*                                          |
| `port`       | Default to `22`                                              | int                                               |





### S3
```yaml title="s3-check.yaml"
        # ...
kind: Canary
spec:
  folder:
    //highlight-next-line
    - path: s3://bucket/folder
      awsConnection:
        # ...
```


### SMB

```yaml title="smb-check.yaml"
# ...
kind: Canary
spec:
  folder:
    //highlight-next-line
    - path: smb:\\192.168.1.9\Some Public Folder\somedir
      smbConnection:
           #...
```
| Field        | Description                                                                                                                                      | Scheme                                                |
| ------------ | ------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------- |
| `connection` | Path of existing connection e.g. `connection://windows/svc-account` <br />Mutually exclusive with`username` and `password` <br /> <Commercial /> | <CommonLink to="connection">_Connections_</CommonLink>  |
| `username`   | <SkipOSS>Mutually exclusive with `connection`</SkipOSS>                                                                                          | <CommonLink to="authentication">_EnvVar_</CommonLink> |
| `password`   | <SkipOSS>Mutually exclusive with `connection`</SkipOSS>                                                                                          | <CommonLink to="authentication">_EnvVar_</CommonLink> |
| `domain`     | Windows domain name                                                                                                                              | _string_                                              |
| `port`       | Default to `445`                                                                                                                                 | _int_                                                 |


### GCS

```yaml title="gcs-check.yaml"
# ...
kind: Canary
spec:
  folder:
  //highlight-next-line
  - path: gcs://bucket/folder
    gcpConnection:
      # ...
```
