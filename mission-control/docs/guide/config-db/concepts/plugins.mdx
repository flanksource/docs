---
title: Plugins
sidebar_custom_props:
  icon: octicon:gear
---

Scrape Plugins are resources that modify the behavior of other scrapers.
They can transform changes, add properties to configs, and even set up relationships between configs.
These behaviors can also be defined on a ScrapeConfig, but using a scrape plugin makes them global, eliminating the need to define them in all scrapers.

For example, if you want to exclude all events with severity="info", a scrape plugin can help you achieve that.

```yaml title="plugin-change-exclusion.yaml" file=<rootDir>/modules/config-db/fixtures/plugins/exclude-info-changes.yaml

```

### Spec

<Fields
  rows={[
    {
      field: 'relationship',
      description: 'Select all the components to link to this check',
      scheme: '[Relationships](./relationships)'
    },
    {
      field: 'properties',
      description: 'Custom templatable properties for the scraped config items.',
      scheme: '[`[]ConfigProperty`](/docs/reference/config-db/properties)'
    },
    {
      field: 'changes.exclude',
      description: 'Ignore changes',
      scheme: '[[]CEL](#exclusions) with [Change Context](/docs/reference/config-db/changes)'
    },
    {
      field: 'changes.mapping',
      description: 'Categorize changes',
      scheme: '[Mapping](#mapping)'
    },
    {
      field: 'retention',
      description: 'Global retention settings for config items and changes',
      scheme: '[Retention](./retention)'
    }
  ]}
/>

### Mapping

When you encounter a diff change, unlike an event-based change, it can sometimes appear unclear. The summary of the change may not immediately indicate its purpose.
For example, the change 'status.images' might not be self-explanatory. To clarify this, you can assign types to these diff changes using mapping.

```yaml title="plugin-change-mapping.yaml" file=<rootDir>/modules/config-db/fixtures/plugins/kubernetes-change-type-mapping.yaml
```

<Fields
  rows={[
    {
      field: 'filter',
      description: 'Selects changes to apply the mapping',
      scheme: 'cel'
    },
    {
      field: 'action',
      description: 'What action to take on the change, if `delete` then the corresponding config item is marked as deleted',
      scheme: '`delete` | `ignore`'
    },
    {
      field: 'type',
      description: 'New change type',
      scheme: 'string'
    },
    {
      field: 'summary',
      description: 'New summary of the change',
      scheme: 'gotemplate'
    }
  ]}
/>

### Retention

Scrape plugins can define global retention policies that are merged with individual scraper retention settings. This is useful for enforcing organization-wide retention policies.

```yaml
apiVersion: configs.flanksource.com/v1
kind: ScrapePlugin
metadata:
  name: global-retention
spec:
  retention:
    changes:
      - name: PullSucceeded
        age: 7d
      - name: diff
        age: 30d
    types:
      - name: Kubernetes::Pod
        deletedAge: 7d
    staleItemAge: 24h
```

When a scraper runs, retention settings from all applicable plugins are merged with the scraper's own retention configuration. See [Retention](./retention) for the full schema.
