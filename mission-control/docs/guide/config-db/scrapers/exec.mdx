---
title: Exec
sidebar_position: 6
sidebar_custom_props:
  icon: console

---

import Custom from './_custom.mdx'

<!-- Source: modules/config-db/api/v1/exec.go -->

The `exec` scraper runs a script and scrapes the output as configuration items. This is useful for custom integrations where you need to fetch configuration from external systems using scripts.

```yaml title='exec-scraper.yaml'
apiVersion: configs.flanksource.com/v1
kind: ScrapeConfig
metadata:
  name: exec-scraper
spec:
  schedule: "@every 1h"
  exec:
    - type: $.type
      id: $.id
      name: $.name
      script: |
        #!/bin/bash
        curl -s https://api.example.com/configs | jq '[.[] | {id: .id, type: "API::Config", name: .name, config: .}]'
```

<details summary="Advanced Example with Git Checkout and Python">

```yaml title='exec-backstage-catalog.yaml' file=<rootDir>/modules/config-db/fixtures/exec-backstage-catalog.yaml

```

</details>

## Scraper

| Field       | Description                                                                        | Scheme                                       | Required |
| ----------- | ---------------------------------------------------------------------------------- | -------------------------------------------- | -------- |
| `schedule`  | Specify the interval to scrape in cron format. Defaults to every 60 minutes.       | `string`                                     |          |
| `full`      | Set to `true` to extract [changes](/docs/guide/config-db/concepts/changes#extracting-changes) and [access logs](/docs/guide/config-db/concepts/access-logs) from scraped configurations. Defaults to `false`. | `bool`                                       |          |
| `retention` | Settings for retaining changes, analysis and scraped items                         | [`Retention`](/docs/guide/config-db/concepts/retention) |          |
| `exec`      | Specifies the list of Exec configurations to scrape.                               | [`[]Exec`](#exec)                          |          |
| `logLevel`  | Specify the level of logging.                                                      | `string`                                     |          |

### Exec

<CustomScraper rows={[
  {
    field: 'script',
    description: 'The script to execute. The script should output JSON to stdout.',
    scheme: 'string',
    required: true
  },
  {
    field: 'env',
    description: 'Environment variables to set during execution',
    scheme: '[[]EnvVar](/docs/reference/env-var)'
  },
  {
    field: 'checkout',
    description: 'Checkout a git repository before running the script',
    scheme: '[GitConnection](/docs/reference/connections/git)'
  },
  {
    field: 'artifacts',
    description: 'Artifacts to collect after execution',
    scheme: '[]Artifact'
  },
  {
    field: 'connections',
    description: 'Connections for AWS/GCP/Azure credential injection',
    scheme: 'ExecConnections'
  },
  {
    field: 'setup',
    description: 'Install runtime dependencies before execution',
    scheme: '[Setup](#setup)'
  }
]}/>

## Setup

The `setup` field allows you to automatically install runtime environments before executing your script. This is useful when your script requires specific versions of Bun or Python.

<Fields rows={[
  {field: 'bun', scheme: '[RuntimeSetup](#runtimesetup)', description: 'Install Bun runtime'},
  {field: 'python', scheme: '[RuntimeSetup](#runtimesetup)', description: 'Install Python runtime via uv'},
]}/>

### RuntimeSetup

<Fields rows={[
  {field: 'version', scheme: 'string', description: 'Version to install (e.g., "1.3.5" for Bun, "3.10.19" for Python, or "latest")'},
]}/>

### Python with Inline Dependencies

For Python scripts, you can declare dependencies inline using [PEP 723 inline script metadata](https://packaging.python.org/en/latest/specifications/inline-script-metadata/). The `uv` package manager is used to manage Python environments.

```yaml
exec:
  - script: |
      #!/usr/bin/env python3
      # /// script
      # dependencies = [
      #   "pyyaml",
      #   "requests",
      # ]
      # ///
      
      import yaml
      import json
      # Your script logic here
      print(json.dumps([{"id": "1", "type": "Example", "name": "test"}]))
    setup:
      python:
        version: "3.10.19"
```

<Custom/>
